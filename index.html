<!doctype html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Губка Боб чат</title>

    <link href="public/css/bootstrap.css" rel="stylesheet" />
    <link href="public/css/custom.css" rel="stylesheet" />

    <script src="public/js/jquery-2.1.3.js"></script>
    <script src="public/js/bubbles.js"></script>
    <script src="public/js/soket.io-1.3.2.js"></script>
    <script src="public/js/lib/jquery-ui.min.js"></script>
    <script src="public/js/src/jquery.textanimation.js"></script>
    <script src="public/js/textControls.js"></script>

    <link rel="shortcut icon" href="favicon.png" />

<!--Login template-->

<script type="text/template" id="login-template">

<div class="col-sm-12 hidden-xs title-div login-title demo login-title" id="demo_roll2">
    <p>Sponge Bob chat   </p>
</div>
<div class="row" id="row">
    <div class="col-sm-6 col-md-4 col-md-offset-4" id="login-form">
        <div class="account-wall" id="wall" style="display:none;">
            <img class="profile-img" src="public/img/Edit.png">
            <div class="form-signin">
                <div class="form-div">
                    <input type="text" id="username" maxlength="14" class="form-control" placeholder="Введите имя" autofocus>
                </div>
                <h3 class="text-center describe">Введите ваше имя или войдите как гость</h3>
                <div class="form-div">
                    <button id="login-button" onclick="setUsername(this)" class="btn btn-lg btn-primary btn-block" >Войти</button>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-4 col-md-offset-1 hidden-xs">
        <img class="img-responsive" src="public/img/wellcome.png" width="400px" height="400px">
    </div>
    <div class="col-sm-6 col-md-4 hidden-xs col-md-offset-3">
        <img class="img-responsive" style="z-index: -30" src="public/img/patrick.png" width="200px" height="200px">
    </div>
</div>

<!--Chat template-->

</script>

<script type="text/template" id="chat-template">
<div class="chat page" id="chat-page">
    <div class="col-xs-12 col-sm-7 " id="left-panel">
        <div class="chat-area">
            <ul class="messages">
                <li>Chat-area</li>
            </ul>
        </div>
    </div>
    <div class="col-xs-12 col-sm-5" >
        <div class="right-panel">
            <div class="users-panel">
                <div class="users-panel">
                    <h1>Users-panel</h1>
                </div>
            </div>
            <div id="message-form">
                <div class="form-div">
                    <input type="text" id="message-text" class="form-control input-lg" placeholder="Введите сообщение" autofocus>
                </div>
                <div class="message-button">
                    <button id="message-button" onclick="sendMessage(this)" class="btn btn-lg btn-primary btn-block" type="submit">Отправить</button>
                </div>
            </div>
            <div class="smiles">
                <h1>Smiles</h1>
            </div>
        </div>
    </div>
</div>
</script>

<body>

<div class="container"></div>

<!--Bubbles and footer    -->
<div id="bubbles">
    <img class="bubble" id="bubble" style="display:none;" width="200px" height="200px" src="public/img/bubble_blue.png" >
</div>
<div>
    <h5 class="footer text-center">&copy Rusinov Alexandr 2015</h5>
</div>
</body>

<script>
    var socket = io();
    var container = $('.container');
    var loginTemplate = $('#login-template');
    var chatTemplate = $('#chat-template');

    switchPage(loginTemplate);


    var messages = $('');


    var username;
    var connected = false;
//    var $currentInput = usernameInput.focus();

    function cleanInput (input) {
        return $.trim($('<div/>').text(input).text());
    }

    function setUsername () {
        var usernameInput = $('#username');
        usernameInput.keypress(function(e){
            if(e.keyCode==13){
                setUsername();
            }
        });
        username = cleanInput(usernameInput.val());
        if (username == ''){
            username = 'Гость';
        }
        socket.emit('add user', username);
        switchPage(chatTemplate);
    }

    function switchPage(page){
        page = $.trim(page.html());
        var children = container.children();
        if (children.length == 0){
        }else{
            children.remove();
        }
        container.append(page);
    }

    socket.on('login', function (data) {
        connected = true;
        console.log(data, 'Login succesfully');
    });

    function sendMessage () {
        var inputMessage = $('#message-text');
        var message = inputMessage.val();
        message = cleanInput(message);
        if (message && connected) {
            inputMessage.val('');
            }
        socket.emit('new message', {message: message, username:username});
    }

    console.log('end of script');
//    function addChatMessage (data) {
//
//        }




//
//    function addMessageElement (el) {
//        var $el = $(el);
//        var options = {};
//
//        messages.prepend($el);
////        $messages.append($el);
//
//        messages[0].scrollTop = messages[0].scrollHeight;
//    }
//

////
//    inputMessage.click(function () {
//        inputMessage.focus();
//    });
//
//
//
//    socket.on('new message', function (data) {
//        addChatMessage(data);
//    });
//
//    socket.on('user joined', function (data) {
//        log(data.username + ' joined');
//        addParticipantsMessage(data);
//    });
//
//    socket.on('user left', function (data) {
//        log(data.username + ' left');
//        addParticipantsMessage(data);
//        removeChatTyping(data);
//    }
//
</script>
</html>